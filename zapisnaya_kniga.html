<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Zapisnaya kniga</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
<style>
	.input-date {
	display: block;
	height: calc(1.5em + .75rem + 2px);
	padding: .375rem .75rem;
	font-size: 1rem;
	font-weight: 400;
	line-height: 1.5;
	color: #495057;
	background-color: #fff;
	background-clip: padding-box;
	border: 1px solid #ced4da;
	transition: border-color .15s ease-in-out,box-shadow .15s ease-in-out;}
</style>
</head>

<body>
<div class="row">
<div class="container">
<table id="table" class="table table-hover table-bordered mt-3">
  <thead>
    <tr>
      <th scope="col">Date</th>
      <th scope="col" style="width:88.5%;">Text</th>
      
    </tr>
  </thead>
  <tbody id="tbody">
  	
  </tbody>
</table>

	<div class="input-group mt-3" id="dataToAdd">
		<input type="date" class="input-date" >
		<input type="text" class="form-control" placeholder="Enter text here">
			  
		<div class="input-group-append" id="button-addon4">
			<button class="btn btn-outline-secondary" type="button" id="add">ADD</button>
		</div>
	</div>
</div>
</div>
<script>
	let add = document.querySelector('#add');
	let tbody = document.querySelector('#tbody');
	let table = document.querySelector('#table');
	let inpGroup = document.querySelector('#dataToAdd');
	let arr = [];

window.addEventListener('load',fillTableFromStorage);
function fillTableFromStorage() {
	let fillElem = '';
	arr = [];
	if (localStorage.getItem('tableRows')!==null) {
		table.style.display = '';
		arr = JSON.parse(localStorage.getItem('tableRows'));
		for (let i = 0; i < arr.length; i++) {
			//tbody.insertAdjacentHTML('afterbegin', `<tr>${arr[i]}</tr>`)
			fillElem += `<tr>${arr[i]}</tr>`;
		}
	tbody.innerHTML = fillElem;
	}
	if (tbody.children.length==0) {
		table.style.display = 'none';
	}
}

window.addEventListener('unload', writeTableDataToLS);
function writeTableDataToLS() {
	arr = [];
	if (tbody.children.length!==0) {
			for (let i = 0; i < tbody.children.length; i++) {
				arr.push(tbody.children[i].innerHTML);
			}
			localStorage.setItem('tableRows', '');
			localStorage.setItem('tableRows', JSON.stringify(arr));
		}
}

//localStorage.clear();
//console.log(arr);


add.addEventListener('click', addDataToTable);
function addDataToTable() {
	if (inpGroup.children[0].value!==''&&inpGroup.children[1].value!=='') {
		tbody.insertAdjacentHTML('afterbegin', `<tr>
			<td scope="row" class="date">${inpGroup.children[0].value}</td>
  			<td colspan="2" class="text">${inpGroup.children[1].value}</td></tr>`);
		inpGroup.children[0].value = '';
		inpGroup.children[1].value = '';
		if (tbody.children.length == 1) {
			table.style.display = '';
			add.innerHTML = 'ADD';
		}
	}
}
tbody.addEventListener('dblclick', initEditDataInTable);
	function initEditDataInTable(e) {
		e.preventDefault();
	 	if (e.target.nodeName == 'TD') {
	 		let editableDate = e.target.parentNode.children[0].innerHTML;
	 		e.target.parentNode.children[0].innerHTML = ''
	 		e.target.parentNode.children[0].insertAdjacentHTML('afterbegin', `<div class="input-group">
					<input type="date" class="input-date" value="${editableDate}" id="editableDate">
				</div>`);
	 		let editableText = e.target.parentNode.children[1].innerHTML;
	 		e.target.parentNode.children[1].innerHTML = '';
	 		e.target.parentNode.children[1].insertAdjacentHTML('afterbegin', `<div class="input-group">
					<input type="text" class="form-control " id="editableText" value="${editableText}">
					<div class="input-group-append">
						<button class="btn btn-outline-success" type="button" id="edit">EDIT</button>
						<button class="btn btn-outline-danger" type="button" id="delete">DELETE</button>
					</div>
				</div>`);
	 	}
let edit = document.querySelector('#edit');
let delBtn = document.querySelector('#delete');
edit.addEventListener('click', editTableRow);
delBtn.addEventListener('click', removeTableRow);	
	 }
function removeTableRow() {
	this.parentNode.parentNode.parentNode.parentNode.remove();
	//console.log(tbody.children.length);
	//console.log(add);
	if (tbody.children.length==0) {
		table.style.display = 'none';
		add.innerHTML = 'CREATE TABLE';
	}
}

function editTableRow(){
	 	//take values from inputs, remove inputs from td, then insert data from values into td
	 	let date = document.querySelector('#editableDate').parentNode.parentNode;
	 	let text = document.querySelector('#editableText').parentNode.parentNode;
	 	let dateVal = document.querySelector('#editableDate').value;
	 	let textVal = document.querySelector('#editableText').value;
	 	date.innerHTML = '';
	 	date.innerHTML = dateVal;
	 	text.innerHTML = '';
	 	text.innerHTML = textVal;
	}

</script>	
</body>
</html>